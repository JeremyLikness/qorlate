/**
 * Correlated promises for AngularJS
 * @version v0.0.4-dev-2015-01-22
 * @link 
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){"use strict";!function(a){function c(a){return b.isFunction(a)?a():a}function d(){}function e(){}b.extend(d.prototype,{id:1,getId:function(){var a=this.id;return this.id+=1,a}}),b.extend(e.prototype,{provider:new d,timeout:5e3,correlations:{},setDefaultTime:function(a){this.timeout=a},setProvider:function(a){this.provider=a},$get:["$q","$timeout",function(a,e){function f(d){var f,i,j=a.defer(),k=null,l=null,m=null,n=null,o=null;if(f=d&&d.id?c(d.id):g.provider.getId(),g.correlations[f]||(g.correlations[f]=[]),d&&d.subscribe){if(l=d.id||c(d.subscribe),g.correlations[l]||(g.correlations[l]=[]),l!==!!l)return m=l+":"+h.getId(),n={id:m},o={resolveFn:b.noop,rejectFn:b.noop},n.always=function(a,c){return o.resolveFn=a,o.rejectFn=c,function(){if(g.correlations[l]&&g.correlations[l][m]){var a=g.correlations[l][m];a.resolveFn=b.noop,a.rejectFn=b.noop,delete g.correlations[l][m]}}},g.correlations[l].push({subscriptionId:m}),g.correlations[l][m]=o,n;throw new Error("Subscription id is required.")}return g.correlations[f].defer?{id:f,promise:g.correlations[f].defer.promise}:(i=c(d&&Object.prototype.hasOwnProperty.call(d,"timeout")?d.timeout:g.timeout),i&&i>=0&&(k=e(function(){j.rejected=!0,j.reject({message:"Qorlate request Timed out.",id:f})},i)),g.correlations[f].push({defer:j,timer:k,timeout:i}),{id:f,promise:j.promise})}var g=this,h=new d;return Object.defineProperty(f,"defaultTimeout",{configurable:!1,enumerable:!0,get:function(){return c(g.timeout)}}),f.immediate=function(b,c){return c?a.reject(b):a.when(b)},f.correlate=function(b,c,d){var f,h,i,j=!1,k=[];for(g.correlations[b]||(g.correlations[b]=[]);g.correlations[b].length;){if(f=g.correlations[b].pop(),f.subscriptionId){if(!g.correlations[b][f.subscriptionId])continue;j=!0,k.push(f.subscriptionId),i=g.correlations[b][f.subscriptionId],f.defer=a.defer(),f.defer.promise.then(i.resolveFn,i.rejectFn)}f.timer&&e.cancel(f.timer),f.defer.rejected||(j=!0,d?f.defer.reject(c):f.defer.resolve(c),h=f.defer)}for(;k.length;)g.correlations[b].push({subscriptionId:k.pop()});return h||(h=a.defer(),d?h.reject(c):h.resolve(c)),g.correlations[b].defer=h,j},f.reject=function(a,b){return this.correlate(a,b,!0)},f.resolve=function(a,b){return this.correlate(a,b,!1)},f}]}),a.provider("qorlate",e)}(b.module("jlikness.qorlate",[]))}(window,window.angular);